<!DOCTYPE html>
<html>
  <head>
    <title>Shift Schedule</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
    <script src=" https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js "></script>
    <style></style>
  </head>
  <body>
    <h2>Shift Schedule</h2>
    <div id="example-table"></div>
    <script>
      var table = new Tabulator('#example-table', {
        ajaxURL: '/roster/events/',
        ajaxContentType: 'json',
        ajaxResponse: function (url, params, response) {
          //url - the URL of the request
          //params - the parameters passed with the request
          //response - the JSON object returned in the body of the response.
      
          return response.data //return the tableData property of a response json object
        },
        layout: 'fitData', //fit columns to width of table (optional)
        headerSort: false,
        autoColumnsDefinitions: [
          { title: 'Registrar', field: 'username', frozen: true, width: 200, formatter: 'plaintext', titleFormatter: 'plaintext' },
          { field: 'year', visible: false }
        ],
        autoColumns: true,
        columnDefaults: {
          hozAlign: 'center',
          headerSort: false,
          resizable: false,
          width: 150,
          headerHozAlign: 'center',
          titleFormatter: 'datetime',
          titleFormatterParams: {
            inputFormat: 'yyyy-MM-dd',
            outputFormat: 'dd/MM/yy EEE',
            invalidPlaceholder: ''
          },
          formatter: function (cell, formatterParams, onRendered) {
            el = cell.getElement()
            content = cell.getValue()
            dateString = cell.getField()
            row = cell.getRow().getElement()
            let date = luxon.DateTime.fromISO(dateString)
            if (date.weekday === 6 || date.weekday === 7) {
              if (row.classList.contains('tabulator-row-even')) {
                el.style.backgroundColor = '#b1b1b1'
              } else if (row.classList.contains('tabulator-row-odd')) {
                el.style.backgroundColor = '#c6c6c6'
              }
            }
            return content
          }
        },
        initialSort: [
          { column: 'year', dir: 'asc' }, //sort by this first
          { column: 'username', dir: 'asc' } //then sort by this second
        ],
        groupBy: 'year',
        groupToggleElement: false
      })
    </script>
  </body>
</html>
